name: 🧪 Test All Scripts

# 🎯 When to run: On every push and PR to ensure code always works
on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  test-scripts:
    name: 🐍 Test Python Scripts
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.9, 3.10, 3.11]
    
    steps:
    # 📥 Get the code
    - name: 📥 Checkout code
      uses: actions/checkout@v4
    
    # 🐍 Set up Python
    - name: 🐍 Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    # 📦 Install dependencies
    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        # Install testing tools
        pip install pytest matplotlib-testing
    
    # 🧪 Test all Python scripts
    - name: 🧪 Test Python scripts
      run: |
        echo "🚀 Testing Module 1: Python Fundamentals"
        cd 1_python_fundamentals
        python 1_python_fundamentals.py
        cd ..
        
        echo "🚀 Testing Module 2: Data Manipulation"
        cd 2_data_manipulation
        python 2_data_manipulation.py
        cd ..
        
        echo "🚀 Testing Module 3: Data Visualization"
        cd 3_data_visualization
        python 3_data_visualization.py
        cd ..
        
        echo "🚀 Testing Module 4: Statistics & ML"
        cd 4_statistics_ml
        python 4_statistics_ml.py
        cd ..
        
        echo "✅ All scripts executed successfully!"
    
    # 🎯 Check code quality
    - name: 🎯 Check code style
      run: |
        pip install flake8
        # Check for basic syntax errors and style issues
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # Check for complexity (relaxed for educational code)
        flake8 . --count --exit-zero --max-complexity=15 --max-line-length=100 --statistics

  # 🎉 Success notification
  notify-success:
    name: 🎉 All Tests Passed
    needs: test-scripts
    runs-on: ubuntu-latest
    steps:
    - name: 🎉 Success
      run: |
        echo "🎊 All Python scripts work perfectly!"
        echo "✅ Ready for learners to use!"
