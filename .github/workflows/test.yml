name: ğŸ§ª Test All Scripts

# ğŸ¯ When to run: On every push and PR to ensure code always works
on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  test-scripts:
    name: ğŸ Test Python Scripts
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.9, 3.10, 3.11]
    
    steps:
    # ğŸ“¥ Get the code
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    # ğŸ Set up Python
    - name: ğŸ Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    # ğŸ“¦ Install dependencies
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        # Install testing tools
        pip install pytest matplotlib-testing
    
    # ğŸ§ª Test all Python scripts
    - name: ğŸ§ª Test Python scripts
      run: |
        echo "ğŸš€ Testing Module 1: Python Fundamentals"
        cd 1_python_fundamentals
        python 1_python_fundamentals.py
        cd ..
        
        echo "ğŸš€ Testing Module 2: Data Manipulation"
        cd 2_data_manipulation
        python 2_data_manipulation.py
        cd ..
        
        echo "ğŸš€ Testing Module 3: Data Visualization"
        cd 3_data_visualization
        python 3_data_visualization.py
        cd ..
        
        echo "ğŸš€ Testing Module 4: Statistics & ML"
        cd 4_statistics_ml
        python 4_statistics_ml.py
        cd ..
        
        echo "âœ… All scripts executed successfully!"
    
    # ğŸ¯ Check code quality
    - name: ğŸ¯ Check code style
      run: |
        pip install flake8
        # Check for basic syntax errors and style issues
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # Check for complexity (relaxed for educational code)
        flake8 . --count --exit-zero --max-complexity=15 --max-line-length=100 --statistics

  # ğŸ‰ Success notification
  notify-success:
    name: ğŸ‰ All Tests Passed
    needs: test-scripts
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ‰ Success
      run: |
        echo "ğŸŠ All Python scripts work perfectly!"
        echo "âœ… Ready for learners to use!"
